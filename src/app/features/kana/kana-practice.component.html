<p-card header="Kana Practice" class="feature-card">
  <div class="flex flex-column gap-4">
    <div class="flex flex-wrap gap-2 align-items-center">
      <span class="font-medium">Mode:</span>
      <p-selectbutton
        [options]="modeOptions"
        [(ngModel)]="mode"
        optionLabel="label"
        optionValue="value"
        (onChange)="onModeChange()"
      />
      <span class="font-medium ml-2">Session size:</span>
      <input
        pInputText
        type="number"
        min="1"
        max="200"
        style="width: 6rem"
        [(ngModel)]="sessionSize"
      />
      <button pButton type="button" severity="secondary" label="New Session" icon="pi pi-refresh" (click)="startSession()"></button>
    </div>

    <div
      class="border-round p-4 text-center kana-prompt-panel"
      [ngClass]="{
        'surface-50': !checkedCurrent,
        'bg-green-100': checkedCurrent && lastAnswerCorrect === true,
        'bg-red-100': checkedCurrent && lastAnswerCorrect === false
      }"
    >
      <div class="text-sm text-color-secondary mb-2">Type the romaji:</div>
      <div class="kana-glyph-badge">
        <span class="text-6xl font-bold">{{ currentPrompt.kana }}</span>
      </div>
    </div>

    <div class="flex flex-column md:flex-row gap-2">
      <input
        pInputText
        class="w-full"
        [(ngModel)]="answer"
        placeholder="Enter romaji (e.g. ka, shi, tsu)"
      />
      <button
        pButton
        type="button"
        label="Check"
        icon="pi pi-check"
        [disabled]="checkedCurrent || sessionFinished"
        (click)="checkAnswer()"
      ></button>
      <button
        pButton
        type="button"
        severity="secondary"
        label="Next"
        icon="pi pi-arrow-right"
        [disabled]="sessionFinished"
        (click)="nextQuestion()"
      ></button>
    </div>

    @if (feedback) {
      <div class="p-3 border-round surface-ground">{{ feedback }}</div>
    }

    <div class="grid">
      <div class="col-12 md:col-4">
        <p-card subheader="Session Correct">
          <span class="text-2xl font-bold">{{ correct }}</span>
        </p-card>
      </div>
      <div class="col-12 md:col-4">
        <p-card subheader="Session Incorrect">
          <span class="text-2xl font-bold">{{ incorrect }}</span>
        </p-card>
      </div>
      <div class="col-12 md:col-4">
        <p-card subheader="Answered">
          <span class="text-2xl font-bold">{{ asked }} / {{ sessionSize }}</span>
        </p-card>
      </div>
    </div>

    @if (sessionFinished) {
      <p-card subheader="Session overview">
        @if (sessionMistakes.length) {
          <div class="flex flex-column gap-2">
            @for (mistake of sessionMistakes; track mistake.kana + mistake.userAnswer) {
              <div class="p-2 border-round surface-100">
                <span class="font-semibold">{{ mistake.kana }}</span>
                <span class="ml-2">({{ mistake.romaji }})</span>
                <span class="ml-2 text-color-secondary">Your answer: {{ mistake.userAnswer }}</span>
              </div>
            }
          </div>
        } @else {
          <span>No mistakes this session. Nice work.</span>
        }
      </p-card>
    }

    <p-card subheader="Weak symbols">
      <span>{{ weakestPreview() }}</span>
    </p-card>
  </div>
</p-card>

