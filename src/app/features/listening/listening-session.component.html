<p-card header="Listening Comprehension" class="feature-card">
  <div class="flex flex-column gap-4">
    <div class="flex flex-wrap gap-2">
      <p-tag severity="info" [value]="'Session answered: ' + sessionReviewed" />
      <p-tag severity="success" [value]="'Session accuracy: ' + sessionAccuracy() + '%'" />
      <p-tag severity="contrast" [value]="'Lifetime accuracy: ' + lifetimeAccuracy() + '%'" />
      @if (exerciseType === 'mcq') {
        <p-tag severity="warn" value="Mode: Multiple choice" />
      } @else {
        <p-tag severity="secondary" value="Mode: Type Japanese" />
      }
    </div>

    @if (currentItem) {
      <p-card subheader="Listen and answer">
        <div class="flex flex-wrap gap-2">
          <button pButton type="button" icon="pi pi-play" label="Play audio" (click)="playAudio()"></button>
          <button
            pButton
            type="button"
            severity="secondary"
            icon="pi pi-volume-up"
            label="Replay"
            (click)="playAudio()"
          ></button>
        </div>
        @if (audioError) {
          <p class="text-color-secondary mt-3 mb-0">{{ audioError }}</p>
        }
      </p-card>

      @if (exerciseType === 'mcq') {
        <div class="grid">
          @for (option of currentItem.options; track option) {
            <div class="col-12 md:col-6">
              <button
                pButton
                type="button"
                class="w-full"
                [outlined]="selectedOption !== option"
                [severity]="answerChecked && option === currentItem.meaning ? 'success' : 'secondary'"
                [label]="option"
                [disabled]="answerChecked"
                (click)="selectOption(option)"
              ></button>
            </div>
          }
        </div>
      } @else {
        <div class="flex flex-column md:flex-row gap-2">
          <input
            pInputText
            class="w-full"
            placeholder="Type the Japanese phrase you hear"
            [(ngModel)]="typedAnswer"
            [disabled]="answerChecked"
          />
          <button
            pButton
            type="button"
            icon="pi pi-check"
            label="Check"
            [disabled]="answerChecked"
            (click)="submitTypingAnswer()"
          ></button>
        </div>
      }

      @if (feedback) {
        <div
          class="p-3 border-round"
          [class.bg-green-100]="answerCorrect === true"
          [class.bg-red-100]="answerCorrect === false"
          [class.surface-ground]="answerCorrect === null"
        >
          {{ feedback }}
        </div>
      }

      @if (revealAnswer) {
        <p-card subheader="Answer">
          <div class="text-2xl font-semibold">{{ currentItem.japanese }}</div>
          <div class="text-color-secondary mt-2">{{ currentItem.meaning }}</div>
        </p-card>
        <button pButton type="button" icon="pi pi-arrow-right" label="Next" (click)="nextQuestion()"></button>
      }
    } @else {
      <p-card subheader="Session complete">
        <p class="m-0">
          You finished this listening set.
          <span class="text-color-secondary">Start another mixed session anytime.</span>
        </p>
        <div class="mt-3">
          <button
            pButton
            type="button"
            icon="pi pi-refresh"
            severity="secondary"
            label="Start another session"
            (click)="startSession()"
          ></button>
        </div>
      </p-card>
    }
  </div>
</p-card>
